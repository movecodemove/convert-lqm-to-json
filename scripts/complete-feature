BRANCH=`git branch --show-current`

if [[ "$BRANCH" != *"feature/"* ]]; then
  echo "Current branch $BRANCH is not a feature branch."
  exit
fi

if [[ `git status -s` != "" ]]; then
  git add --all
  git commit
fi

[ $? -ne 0 ] && exit

poetry run pytest tests

[ $? -ne 0 ] && exit

git checkout develop
git pull
git merge --edit --squash $BRANCH

[ $? -ne 0 ] && exit

git push

[ $? -ne 0 ] && exit

git branch -d $BRANCH
git push origin --delete $BRANCH
