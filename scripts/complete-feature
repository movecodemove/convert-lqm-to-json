set -e

BRANCH=`git branch --show-current`

if [[ "$BRANCH" != *"feature/"* ]]; then
  echo "Current branch $BRANCH is not a feature branch."
  exit
fi

poetry run pytest tests

if [[ `git status -s` != "" ]]; then
  git add --all
  git commit
fi

git checkout develop
git pull
git merge --edit --squash $BRANCH
git push
git branch -d $BRANCH
git push origin --delete $BRANCH
